# `Mao` 语言运行器 项目文档

## 项目需求

编写一个程序能够运行 `Mao` 语言代码。

以命令行第一个参数为 `Mao` 语言源代码路径，读取并执行该源代码，结果在屏幕上输出即可。

## 对项目需求的分析

- 全方面地考查对 `C` 语言的熟悉和掌握程度。 需要一定的算法和数据结构基础。包括(仅结合本人代码举例):后缀表达式、单向链表、哈希(`Hash`)、递归、模拟算法。 

- 通过学习`Google C++ Style Guide`的内容编写美观、规范、易读的程序。

- 需要一定的观察能力、分析能力、危机处理能力。需要处理编
写、调试过程中处理各种棘手问题的能力。

## 算法思想概述
 
### 算法建立于一个单向链表的基础上。

利用单向链表动态地 建立、修改、储存、提取变量的名称、类型、值。

优点是能够动态分配内存，无论输入数据规模多大都能非常轻松地应对， 

缺点是增加代码量。

### 算法的读入

按句读入。语句以分号为结尾。由于只有顺 序结构，前后语句之间没有关联。为了节省内存，采取一句一 句地读入并读取的方法。

优点: 节省内存。

### 语句的处理

采用语法分析树的方法，利用将字符串拆分 成子串处理各种语句和表达式，每个子串都自带值和类型。

如在处理`int a,b;`这个语句时，当搜索到`int`的时候，处理子串 `a,b`,通过从右向左搜索逗号，继续拆分出子串 `a`和`b`; 

再比如处理`num_a = num_b + 3`，搜索到比加号优先度更高的赋值号，语句可拆分为`num_a`为 `num_b + 3`，此时应计算出后者的值和类型并赋给 `num_a` 这 个变量。通过搜索子串中的加号又可以拆分成子串 `num_b` 和 `3`，获取 `num_b` 和 `3` 的值和类型并相加，则可得到 `num_b+3` 的值和类型。

### 对于各种运算符和特殊语句的处理。

####int/double

将 int/double 后面的子串放入 `define_var` 函数内处理，从右往左搜索逗号，将逗号后面 的子串作为变量名。将变量名、值、类型放入链表尾部储存。 

#### print

计算 print 后面括号内的表达式的值和类型，并返回至 print_var 函数内打印。

运算符的优先度:

> `赋值号`<`加号`、`减号`<`乘号`、`除号`<`负号`<`括号` 

#### 加、减、乘、除号的处理

从右向左搜索，在无括号入栈的情况下，直接处理运算符前后的子串，计算出其值和类型分别 加、减、乘、除。

除号则根据除数的值和表达式的类型(整除 或直接相除)进行特别处理。

类型用 `and` 运算(如其一为 double 则结果为 double) 赋值号的处理: 从左向右搜索，在无括号入栈的情况下，将赋 值号前的子串作为变量名，将赋值号后的子串作为表达式。

将表达式的值和类型赋给变量。 

#### 负号的处理

从右向左搜索，在读入语句的时候预处理。

若减号前为等号、左括号、乘号、除号或减号为该语句的第一个非 空格字符，则该减号应当成负号处理(用大于号直接替换负号，便于之后处理)。在无括号入栈的情况下，返回负号后面的子串表达式的值的相反数。

#### 括号的处理

对于某字符串，左端为左括号，右端为右括号， 则处理括号内的子串。

### 哈希算法的使用

在实际变量的处理中，字符串的比对需要消耗大量时间。运 用哈希算法可以将字符串转化为整型，直接进行整型的比对 可提高效率。

### 识别表达式的数字

`string.h` 头文件中自带的 `strtod` 函数可将字符串转化为数字。

对于返回值为 0 的函数则可能为 0 或者变量名。

注意:4 和 4.0 的区别(通过搜索小数点区别)。


## 在编写过程中曾遇到的问题

1. 处理空格的问题

2. 负号的问题

3. 赋值号的嵌套问题

4. 对于语句(a)=1 的处理。

5. 对于整除和直接相除的问题

## 感想与心得

略

## 参考文献

-  Mao 语言源代码与输出.zip
- 逆波兰表达式
- 链表
- Google C++ style guide